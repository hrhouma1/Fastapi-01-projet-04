###############################################################################
# ğŸš€ API CRUD FastAPI - Tests chronologiques et logiques
# 
# âš ï¸  ORDRE IMPORTANT : Respectez cet ordre pour une utilisation cohÃ©rente !
# 
# 1ï¸âƒ£ D'abord crÃ©er des UTILISATEURS
# 2ï¸âƒ£ Ensuite crÃ©er des ARTICLES pour ces utilisateurs
# 3ï¸âƒ£ Puis effectuer les opÃ©rations de consultation/modification
# 4ï¸âƒ£ Enfin nettoyer les donnÃ©es de test
#
# ğŸ“ Instructions :
# - Lancez d'abord votre API : python safe_start.py
# - ExÃ©cutez ces requÃªtes dans l'ordre (utilisez VS Code avec l'extension REST Client)
# - Modifiez les valeurs selon vos besoins
###############################################################################

@baseUrl = http://localhost:8000

### ğŸ  1. VÃ‰RIFICATION - API en ligne
GET {{baseUrl}}/
Accept: application/json

### ğŸ“Š 2. Ã‰TAT INITIAL - VÃ©rifier les donnÃ©es existantes

# Voir tous les utilisateurs (doit Ãªtre vide au dÃ©but)
GET {{baseUrl}}/users/
Accept: application/json

###

# Voir tous les articles (doit Ãªtre vide au dÃ©but)
GET {{baseUrl}}/items/
Accept: application/json

###############################################################################
# ğŸ“ Ã‰TAPE 1 : CRÃ‰ATION DES UTILISATEURS (OBLIGATOIRE EN PREMIER)
###############################################################################

### ğŸ‘¤ 3. CRÃ‰ER UTILISATEUR 1 - Marie Dupont
POST {{baseUrl}}/users/
Content-Type: application/json

{
  "email": "marie.dupont@example.com",
  "nom": "Dupont",
  "prenom": "Marie",
  "is_active": true
}

###

### ğŸ‘¤ 4. CRÃ‰ER UTILISATEUR 2 - Jean Martin
POST {{baseUrl}}/users/
Content-Type: application/json

{
  "email": "jean.martin@example.com", 
  "nom": "Martin",
  "prenom": "Jean",
  "is_active": true
}

###

### ğŸ‘¤ 5. CRÃ‰ER UTILISATEUR 3 - Sophie Durand
POST {{baseUrl}}/users/
Content-Type: application/json

{
  "email": "sophie.durand@example.com",
  "nom": "Durand", 
  "prenom": "Sophie",
  "is_active": false
}

###

### âœ… 6. VÃ‰RIFIER LES UTILISATEURS CRÃ‰Ã‰S
GET {{baseUrl}}/users/
Accept: application/json

###############################################################################
# ğŸ“¦ Ã‰TAPE 2 : CRÃ‰ATION DES ARTICLES (APRÃˆS AVOIR LES UTILISATEURS)
###############################################################################

### ğŸ›ï¸ 7. CRÃ‰ER ARTICLE 1 - Ordinateur portable (pour Marie, ID=1)
POST {{baseUrl}}/users/1/items/
Content-Type: application/json

{
  "title": "MacBook Pro 16 pouces",
  "description": "Ordinateur portable excellent Ã©tat, 32GB RAM, 1TB SSD",
  "price": 250000,
  "is_available": true
}

###

### ğŸ›ï¸ 8. CRÃ‰ER ARTICLE 2 - Smartphone (pour Marie, ID=1)
POST {{baseUrl}}/users/1/items/
Content-Type: application/json

{
  "title": "iPhone 15 Pro",
  "description": "Smartphone rÃ©cent, Ã©tat neuf avec accessoires",
  "price": 120000,
  "is_available": true
}

###

### ğŸ›ï¸ 9. CRÃ‰ER ARTICLE 3 - VÃ©lo (pour Jean, ID=2)
POST {{baseUrl}}/users/2/items/
Content-Type: application/json

{
  "title": "VÃ©lo Ã©lectrique",
  "description": "VTT Ã©lectrique, batterie autonomie 80km",
  "price": 180000,
  "is_available": true
}

###

### ğŸ›ï¸ 10. CRÃ‰ER ARTICLE 4 - Livre (pour Jean, ID=2)
POST {{baseUrl}}/users/2/items/
Content-Type: application/json

{
  "title": "Collection livres informatique",
  "description": "20 livres sur Python, JavaScript, et DevOps",
  "price": 15000,
  "is_available": false
}

###

### âŒ 11. TEST ERREUR - CrÃ©er article pour utilisateur inexistant (ID=999)
# Cette requÃªte DOIT Ã©chouer avec une erreur 404
POST {{baseUrl}}/users/999/items/
Content-Type: application/json

{
  "title": "Article impossible",
  "description": "Cet article ne devrait pas Ãªtre crÃ©Ã©",
  "price": 1000,
  "is_available": true
}

###############################################################################
# ğŸ” Ã‰TAPE 3 : CONSULTATION DES DONNÃ‰ES
###############################################################################

### ğŸ“‹ 12. VOIR TOUS LES ARTICLES CRÃ‰Ã‰S
GET {{baseUrl}}/items/
Accept: application/json

###

### ğŸ‘¤ 13. VOIR UTILISATEUR 1 AVEC SES ARTICLES
GET {{baseUrl}}/users/1
Accept: application/json

###

### ğŸ‘¤ 14. VOIR UTILISATEUR 2 AVEC SES ARTICLES
GET {{baseUrl}}/users/2
Accept: application/json

###

### ğŸ“¦ 15. VOIR ARTICLE SPÃ‰CIFIQUE (ID=1)
GET {{baseUrl}}/items/1
Accept: application/json

###

### ğŸ“‹ 16. PAGINATION - Voir seulement 2 articles
GET {{baseUrl}}/items/?skip=0&limit=2
Accept: application/json

###############################################################################
# âœï¸ Ã‰TAPE 4 : MODIFICATIONS (UPDATE)
###############################################################################

### ğŸ‘¤ 17. MODIFIER UTILISATEUR 1 - Changer le nom
PUT {{baseUrl}}/users/1
Content-Type: application/json

{
  "nom": "Dupont-Martin",
  "prenom": "Marie-Claire"
}

###

### ğŸ›ï¸ 18. MODIFIER ARTICLE 1 - RÃ©duire le prix
PUT {{baseUrl}}/items/1
Content-Type: application/json

{
  "price": 220000,
  "description": "MacBook Pro 16 pouces - PRIX RÃ‰DUIT ! 32GB RAM, 1TB SSD"
}

###

### ğŸ›ï¸ 19. MARQUER ARTICLE 2 COMME NON DISPONIBLE
PUT {{baseUrl}}/items/2
Content-Type: application/json

{
  "is_available": false
}

###

### âœ… 20. VÃ‰RIFIER LES MODIFICATIONS
GET {{baseUrl}}/users/1
Accept: application/json

###############################################################################
# ğŸ” Ã‰TAPE 5 : TESTS DE RECHERCHE ET VALIDATION
###############################################################################

### ğŸ‘¤ 21. CHERCHER UTILISATEUR PAR EMAIL (test logique mÃ©tier)
GET {{baseUrl}}/users/
Accept: application/json

# Note: Il faudrait ajouter un endpoint de recherche par email
# GET {{baseUrl}}/users/search?email=marie.dupont@example.com

###

### âŒ 22. TEST ERREUR - Utilisateur inexistant
GET {{baseUrl}}/users/999
Accept: application/json

###

### âŒ 23. TEST ERREUR - Article inexistant
GET {{baseUrl}}/items/999
Accept: application/json

###

### âŒ 24. TEST ERREUR - Modifier utilisateur inexistant
PUT {{baseUrl}}/users/999
Content-Type: application/json

{
  "nom": "Utilisateur fantÃ´me"
}

###############################################################################
# ğŸ—‘ï¸ Ã‰TAPE 6 : NETTOYAGE (ORDRE IMPORTANT !)
# âš ï¸ Supprimer d'abord les ARTICLES, puis les UTILISATEURS
###############################################################################

### ğŸ—‘ï¸ 25. SUPPRIMER ARTICLE 1
DELETE {{baseUrl}}/items/1
Accept: application/json

###

### ğŸ—‘ï¸ 26. SUPPRIMER ARTICLE 2  
DELETE {{baseUrl}}/items/2
Accept: application/json

###

### ğŸ—‘ï¸ 27. SUPPRIMER ARTICLE 3
DELETE {{baseUrl}}/items/3
Accept: application/json

###

### ğŸ—‘ï¸ 28. SUPPRIMER ARTICLE 4
DELETE {{baseUrl}}/items/4
Accept: application/json

###

### âœ… 29. VÃ‰RIFIER QUE TOUS LES ARTICLES SONT SUPPRIMÃ‰S
GET {{baseUrl}}/items/
Accept: application/json

###

### ğŸ—‘ï¸ 30. SUPPRIMER UTILISATEUR 1 (maintenant sans articles)
DELETE {{baseUrl}}/users/1
Accept: application/json

###

### ğŸ—‘ï¸ 31. SUPPRIMER UTILISATEUR 2
DELETE {{baseUrl}}/users/2
Accept: application/json

###

### ğŸ—‘ï¸ 32. SUPPRIMER UTILISATEUR 3
DELETE {{baseUrl}}/users/3
Accept: application/json

###

### âœ… 33. VÃ‰RIFICATION FINALE - Tout doit Ãªtre vide
GET {{baseUrl}}/users/
Accept: application/json

###

GET {{baseUrl}}/items/
Accept: application/json

###############################################################################
# ğŸ§ª Ã‰TAPE 7 : TESTS AVANCÃ‰S DE COHÃ‰RENCE
###############################################################################

### ğŸ§ª 34. TEST CASCADE DELETE - CrÃ©er utilisateur et articles puis supprimer utilisateur
POST {{baseUrl}}/users/
Content-Type: application/json

{
  "email": "test.cascade@example.com",
  "nom": "Test",
  "prenom": "Cascade",
  "is_active": true
}

###

# CrÃ©er un article pour ce nouvel utilisateur (supposons ID=4)
POST {{baseUrl}}/users/4/items/
Content-Type: application/json

{
  "title": "Article de test CASCADE",
  "description": "Cet article devrait Ãªtre supprimÃ© automatiquement",
  "price": 1000,
  "is_available": true
}

###

# VÃ©rifier que l'article a Ã©tÃ© crÃ©Ã©
GET {{baseUrl}}/items/
Accept: application/json

###

# Supprimer l'utilisateur (doit supprimer automatiquement ses articles)
DELETE {{baseUrl}}/users/4
Accept: application/json

###

# VÃ©rifier que l'article a bien Ã©tÃ© supprimÃ© automatiquement
GET {{baseUrl}}/items/
Accept: application/json

###############################################################################
# ğŸ“š DOCUMENTATION ET OUTILS
###############################################################################

### ğŸ“– 35. ACCÃ‰DER Ã€ LA DOCUMENTATION INTERACTIVE
# Ouvrez dans votre navigateur : http://localhost:8000/docs

### ğŸ“Š 36. ACCÃ‰DER Ã€ LA DOCUMENTATION ALTERNATIVE
# Ouvrez dans votre navigateur : http://localhost:8000/redoc

###############################################################################
# ğŸ’¡ NOTES IMPORTANTES :
#
# 1. âœ… ORDRE OBLIGATOIRE : Utilisateurs â†’ Articles â†’ Modifications â†’ Suppressions
# 2. âš ï¸  Ne jamais crÃ©er d'articles sans utilisateur propriÃ©taire existant
# 3. ğŸ”„ La suppression d'un utilisateur supprime automatiquement ses articles (CASCADE)
# 4. ğŸ’° Les prix sont en centimes (ex: 250000 = 2500,00â‚¬)
# 5. ğŸ“ Les emails doivent Ãªtre uniques
# 6. ğŸ” Utilisez la documentation interactive pour explorer l'API
# 7. ğŸ› ï¸ En cas de problÃ¨me de port : python safe_start.py --auto-port
###############################################################################
