# API CRUD FastAPI

Une API compl√®te d√©velopp√©e avec FastAPI qui impl√©mente toutes les op√©rations CRUD (Create, Read, Update, Delete) pour la gestion d'utilisateurs et d'articles.

## Fonctionnalit√©s

- ‚úÖ **Op√©rations CRUD compl√®tes** pour les utilisateurs et articles
- ‚úÖ **Base de donn√©es SQLite** avec SQLAlchemy
- ‚úÖ **Validation automatique** des donn√©es avec Pydantic
- ‚úÖ **Documentation automatique** avec Swagger UI
- ‚úÖ **Relations entre entit√©s** (utilisateurs ‚Üî articles)
- ‚úÖ **Gestion des erreurs** et codes de statut HTTP appropri√©s
- üÜï **Interface graphique PySide6** moderne et intuitive
- üÜï **Client API int√©gr√©** pour communication GUI ‚Üî API

## Structure du projet

```
projetsfastapi/
‚îú‚îÄ‚îÄ venv/             # Environnement virtuel Python (√† cr√©er)
‚îú‚îÄ‚îÄ main.py           # Point d'entr√©e de l'application FastAPI
‚îú‚îÄ‚îÄ database.py       # Configuration de la base de donn√©es
‚îú‚îÄ‚îÄ models.py         # Mod√®les SQLAlchemy (tables de base de donn√©es)
‚îú‚îÄ‚îÄ schemas.py        # Sch√©mas Pydantic (validation et s√©rialisation)
‚îú‚îÄ‚îÄ crud.py           # Op√©rations CRUD
‚îú‚îÄ‚îÄ requirements.txt  # D√©pendances Python (FastAPI + PySide6)
‚îú‚îÄ‚îÄ exemple_utilisation.py  # Script de test de l'API
‚îú‚îÄ‚îÄ api_tests.http    # Tests HTTP chronologiques avec REST Client
‚îú‚îÄ‚îÄ test_coherence.py # Test rapide de coh√©rence des donn√©es
‚îú‚îÄ‚îÄ setup.bat         # Script de configuration automatique (Windows)
‚îú‚îÄ‚îÄ setup.sh          # Script de configuration automatique (macOS/Linux)
‚îú‚îÄ‚îÄ safe_start.py     # Script de d√©marrage s√©curis√© avec gestion des ports
‚îú‚îÄ‚îÄ check_ports.py    # Diagnostic et gestion des ports de d√©veloppement
‚îú‚îÄ‚îÄ gui_client/       # üÜï Interface graphique PySide6
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py   #     Package principal GUI
‚îÇ   ‚îú‚îÄ‚îÄ api_client.py #     Client de communication API
‚îÇ   ‚îú‚îÄ‚îÄ main_window.py #    Interface utilisateur compl√®te
‚îÇ   ‚îî‚îÄ‚îÄ README.md     #     Guide rapide GUI
‚îú‚îÄ‚îÄ run_gui.py        # üÜï Script de lancement interface graphique
‚îú‚îÄ‚îÄ setup_gui.py      # üÜï Configuration automatique GUI
‚îú‚îÄ‚îÄ test_gui_integration.py # üÜï Tests d'int√©gration GUI ‚Üî API
‚îú‚îÄ‚îÄ GUIDE_GESTION_PROCESSUS.md  # Guide complet de gestion des processus
‚îú‚îÄ‚îÄ documentation/    # Documentation de formation compl√®te (8 modules)
‚îú‚îÄ‚îÄ documentation1/   # üÜï Documentation professionnelle (sans emojis)
‚îÇ   ‚îú‚îÄ‚îÄ 01-GUIDE_SEED_DATA.md    # Guide des donn√©es d'exemple
‚îÇ   ‚îú‚îÄ‚îÄ 02-URLS_TESTS.md         # URLs testables compl√®tes  
‚îÇ   ‚îú‚îÄ‚îÄ 03-guide-execution.md    # Guide d'ex√©cution √©tape par √©tape
‚îÇ   ‚îî‚îÄ‚îÄ 04-interface-graphique.md # üÜï Guide complet de l'interface GUI
‚îú‚îÄ‚îÄ URLS_TESTS.md     # Liste compl√®te de toutes les URLs √† tester
‚îú‚îÄ‚îÄ seed_data.py      # Script pour ajouter des donn√©es d'exemple
‚îú‚îÄ‚îÄ GUIDE_SEED_DATA.md # Guide d√©taill√© des donn√©es d'exemple
‚îú‚îÄ‚îÄ .gitignore        # Fichiers √† ignorer par Git
‚îú‚îÄ‚îÄ test.db           # Base de donn√©es SQLite (cr√©√©e automatiquement)
‚îî‚îÄ‚îÄ README.md         # Documentation
```

## Installation et lancement

### Option A : Configuration automatique (recommand√©e)

**Configuration compl√®te (API + Interface graphique) :**
```bash
# Windows
setup.bat

# macOS/Linux  
./setup.sh

# Configuration sp√©cifique GUI
python setup_gui.py
```

Ces scripts vont automatiquement :
- Cr√©er l'environnement virtuel
- Installer toutes les d√©pendances (FastAPI + PySide6)
- Vous donner les instructions pour lancer l'API et l'interface

### Option B : Configuration manuelle

### 1. Cr√©er et activer un environnement virtuel

```bash
# Cr√©er l'environnement virtuel
python -m venv venv

# Activer l'environnement virtuel
# Sur Windows :
venv\Scripts\activate
# Sur macOS/Linux :
source venv/bin/activate
```

### 2. Installer les d√©pendances

```bash
pip install -r requirements.txt
```

### 3. Lancer l'application

> **‚ö†Ô∏è Important :** Assurez-vous que l'environnement virtuel est activ√© avant de lancer l'application !

#### Option A : D√©marrage s√©curis√© (recommand√©)
```bash
python safe_start.py
```

#### Option B : D√©marrage standard
```bash
python main.py
```

#### Option C : Avec uvicorn directement
```bash
uvicorn main:app --reload --host 0.0.0.0 --port 8000
```

#### **Gestion des conflits de ports :**

Si vous obtenez l'erreur `[Errno 10048]` (port d√©j√† utilis√©) :

```bash
# Diagnostic des ports
python check_ports.py

# D√©marrage avec port automatique
python safe_start.py --auto-port

# Arr√™ter les processus conflictuels
python safe_start.py --force-kill

# Lib√©rer un port sp√©cifique
python check_ports.py --kill-port 8000
```

### 4. Acc√©der √† l'API

- **API** : http://localhost:8000
- **Documentation Swagger** : http://localhost:8000/docs
- **Documentation ReDoc** : http://localhost:8000/redoc

### 5. üÜï Lancer l'interface graphique (optionnel)

```bash
# Terminal s√©par√© - Interface graphique moderne
python run_gui.py
```

**Avantages de l'interface graphique :**
- ‚úÖ Gestion visuelle des utilisateurs et articles
- ‚úÖ Recherche en temps r√©el
- ‚úÖ Formatage automatique des prix
- ‚úÖ Indicateur de connexion √† l'API
- ‚úÖ Interface moderne et intuitive

### 6. D√©sactiver l'environnement virtuel

Quand vous avez termin√© de travailler sur le projet :

```bash
deactivate
```

> **üí° Note importante :** Assurez-vous toujours que l'environnement virtuel est activ√© (vous devriez voir `(venv)` au d√©but de votre invite de commande) avant d'installer des d√©pendances ou de lancer l'application.

## Endpoints disponibles

### Utilisateurs

| M√©thode | Endpoint | Description |
|---------|----------|-------------|
| `POST` | `/users/` | **üî¥ 1√®re √âTAPE** - Cr√©er un utilisateur |
| `GET` | `/users/` | R√©cup√©rer tous les utilisateurs |
| `GET` | `/users/{user_id}` | R√©cup√©rer un utilisateur par ID |
| `GET` | `/users/{user_id}/items/` | R√©cup√©rer tous les articles d'un utilisateur |
| `PUT` | `/users/{user_id}` | Mettre √† jour un utilisateur |
| `DELETE` | `/users/{user_id}` | Supprimer un utilisateur et ses articles (CASCADE) |

### Articles

| M√©thode | Endpoint | Description |
|---------|----------|-------------|
| `POST` | `/users/{user_id}/items/` | **üü° 2√®me √âTAPE** - Cr√©er un article pour un utilisateur existant |
| `GET` | `/items/` | R√©cup√©rer tous les articles |
| `GET` | `/items/{item_id}` | R√©cup√©rer un article par ID |
| `PUT` | `/items/{item_id}` | Mettre √† jour un article |
| `DELETE` | `/items/{item_id}` | Supprimer un article |

### Recherche

| M√©thode | Endpoint | Description |
|---------|----------|-------------|
| `GET` | `/search/items?q=terme&limit=50` | üÜï Rechercher des articles par mots-cl√©s |

> **‚ö†Ô∏è ORDRE IMPORTANT :** Vous devez d'abord cr√©er des utilisateurs, puis cr√©er des articles pour ces utilisateurs. La cr√©ation d'un article pour un utilisateur inexistant retournera une erreur 404.

## Exemples d'utilisation

### Cr√©er un utilisateur

```bash
curl -X POST "http://localhost:8000/users/" \
     -H "Content-Type: application/json" \
     -d '{
       "email": "john.doe@example.com",
       "nom": "Doe",
       "prenom": "John",
       "is_active": true
     }'
```

### Cr√©er un article

```bash
curl -X POST "http://localhost:8000/users/1/items/" \
     -H "Content-Type: application/json" \
     -d '{
       "title": "Mon premier article",
       "description": "Description de l\''article",
       "price": 2500,
       "is_available": true
     }'
```

### R√©cup√©rer tous les utilisateurs

```bash
curl -X GET "http://localhost:8000/users/"
```

### Mettre √† jour un utilisateur

```bash
curl -X PUT "http://localhost:8000/users/1" \
     -H "Content-Type: application/json" \
     -d '{
       "nom": "Nouveau Nom"
     }'
```

### Supprimer un article

```bash
curl -X DELETE "http://localhost:8000/items/1"
```

### üÜï Rechercher des articles

```bash
# Recherche simple
curl -X GET "http://localhost:8000/search/items?q=iPhone"

# Recherche avec limite de r√©sultats
curl -X GET "http://localhost:8000/search/items?q=macbook&limit=10"

# Recherche avec espaces (URL encod√©e)
curl -X GET "http://localhost:8000/search/items?q=Python%20livre"
```

## Mod√®les de donn√©es

### Utilisateur

```json
{
  "id": 1,
  "email": "john.doe@example.com",
  "nom": "Doe",
  "prenom": "John",
  "is_active": true,
  "created_at": "2024-01-15T10:30:00Z",
  "updated_at": "2024-01-15T10:30:00Z",
  "items": []
}
```

### Article

```json
{
  "id": 1,
  "title": "Mon article",
  "description": "Description de l'article",
  "price": 2500,
  "is_available": true,
  "owner_id": 1,
  "created_at": "2024-01-15T10:30:00Z",
  "updated_at": "2024-01-15T10:30:00Z"
}
```

## Fonctionnalit√©s avanc√©es

- **Pagination** : Param√®tres `skip` et `limit` pour la pagination des listes
- **Validation automatique** : Pydantic valide automatiquement les donn√©es d'entr√©e
- **Relations CASCADE** : La suppression d'un utilisateur supprime automatiquement ses articles
- **Timestamps automatiques** : Dates de cr√©ation et modification g√©r√©es automatiquement
- **Gestion des erreurs** : Messages d'erreur appropri√©s avec codes de statut HTTP

## Technologies utilis√©es

- **FastAPI** : Framework web moderne et rapide
- **SQLAlchemy** : ORM pour la gestion de base de donn√©es
- **Pydantic** : Validation et s√©rialisation des donn√©es
- **SQLite** : Base de donn√©es l√©g√®re
- **Uvicorn** : Serveur ASGI haute performance

## Test de l'API

### Option 1 : Tests HTTP chronologiques (recommand√©) 

Un fichier `api_tests.http` complet avec l'ordre logique est inclus :

```bash
# 1. Lancez l'API
python safe_start.py

# 2. Ouvrez api_tests.http dans VS Code avec l'extension REST Client
# 3. Ex√©cutez les requ√™tes dans l'ordre chronologique
```

Ce fichier contient :
- ‚úÖ **35+ tests chronologiques** dans l'ordre logique
- üî¥ **√âtape 1** : Cr√©ation des utilisateurs (obligatoire)
- üü° **√âtape 2** : Cr√©ation des articles pour ces utilisateurs
- üîµ **√âtape 3** : Consultations et modifications
- ‚ö´ **√âtape 4** : Nettoyage des donn√©es
- ‚ùå **Tests d'erreurs** pour valider la coh√©rence

### Option 2 : Test de coh√©rence rapide

```bash
# Teste la validation et l'ordre logique (utilisateurs ‚Üí articles)
python test_coherence.py
```

### Option 3 : Script de test automatis√© complet

```bash
# Assurez-vous que l'API est lanc√©e (python safe_start.py)
python exemple_utilisation.py
```

### Option 4 : Test manuel avec curl

Vous pouvez aussi tester manuellement avec les exemples curl fournis dans la section "Exemples d'utilisation".

### Option 5 : Documentation interactive

Acc√©dez √† http://localhost:8000/docs pour tester l'API directement depuis votre navigateur avec l'interface Swagger.

### Option 6 : Guide des URLs de test

Consultez le fichier `URLS_TESTS.md` qui contient **toutes les URLs** que vous pouvez tester :
- URLs directement testables dans le navigateur  
- URLs n√©cessitant des outils sp√©ciaux
- S√©quence de test recommand√©e
- Gestion des ports alternatifs

### Option 7 : Donn√©es d'exemple (recommand√© pour d√©buter)

Ajoutez rapidement des donn√©es d'exemple dans votre base de donn√©es :

```bash
# Ajouter des utilisateurs et articles d'exemple
python seed_data.py add

# Voir l'√©tat de la base de donn√©es
python seed_data.py status

# Ajout rapide d'un utilisateur de test
python seed_data.py quick

# Remettre √† z√©ro et ajouter les donn√©es d'exemple
python seed_data.py reset
```

> **üí° Conseil :** Utilisez `seed_data.py add` pour avoir imm√©diatement des donn√©es √† tester, puis consultez `URLS_TESTS.md` pour savoir quelles URLs visiter.

## üõ†Ô∏è Outils de diagnostic et gestion

### Diagnostic des ports

```bash
# V√©rifier quels ports sont utilis√©s
python check_ports.py

# Afficher les commandes utiles
python check_ports.py --show-commands

# Arr√™ter tous les processus Python
python check_ports.py --kill-all-python
```

### D√©marrage s√©curis√©

```bash
# D√©marrage normal
python safe_start.py

# Avec recherche automatique de port libre
python safe_start.py --auto-port

# Avec arr√™t forc√© des processus conflictuels
python safe_start.py --force-kill

# Sur un port sp√©cifique
python safe_start.py --port 8080

# Sans rechargement automatique
python safe_start.py --no-reload
```

### Guide complet

Consultez le fichier `GUIDE_GESTION_PROCESSUS.md` pour un guide d√©taill√© sur :
- üîç Identification des processus et ports
- ‚ö° Arr√™t des processus (Windows/macOS/Linux)
- üõ°Ô∏è Pr√©vention des conflits
- ü§ñ Scripts d'automatisation
- üìö Commandes par technologie (Python, Node.js, etc.)

## D√©veloppement

L'API est pr√™te √† √™tre utilis√©e et peut √™tre facilement √©tendue avec de nouvelles fonctionnalit√©s :

- Authentification et autorisation
- Upload de fichiers
- Syst√®me de cache
- Tests automatis√©s
- D√©ploiement avec Docker

Bonne utilisation de votre API CRUD FastAPI ! üöÄ
